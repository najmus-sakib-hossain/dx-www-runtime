use wasm_bindgen :: prelude :: * ; use web_sys :: { Document , Element , HtmlElement , Node , window } ; # [wasm_bindgen] extern "C" { # [wasm_bindgen (js_namespace = console)] fn log (s : & str) ; } const BIT_0 : u64 = 1 << 0 ; const BIT_1 : u64 = 1 << 1 ; const BIT_2 : u64 = 1 << 2 ; const BIT_3 : u64 = 1 << 3 ; const BIT_4 : u64 = 1 << 4 ; const BIT_5 : u64 = 1 << 5 ; const BIT_6 : u64 = 1 << 6 ; const BIT_7 : u64 = 1 << 7 ; # [wasm_bindgen (start)] pub fn init_templates () { let window = window () . expect ("no global window") ; let document = window . document () . expect ("no document") ; { let template = document . create_element ("template") . unwrap () ; template . set_inner_html ("<div class=\"counter\">\r\n            <h1>Count: <!--SLOT_0--></h1>\r\n            <div class=\"controls\">\r\n                <!-- Simple Increment -->\r\n            </div>\r\n        </div>") ; } log (& format ! ("Registered {} templates" , 1usize)) ; } # [wasm_bindgen] pub struct Counter { dirty_mask : u64 , pub count : i32 , } # [wasm_bindgen] impl Counter { # [wasm_bindgen (constructor)] pub fn new () -> Self { Self { dirty_mask : 0 , count : 0 , } } pub fn mark_dirty (& mut self , bit : u8) { self . dirty_mask |= 1u64 << bit ; } pub fn clear_dirty (& mut self) { self . dirty_mask = 0 ; } pub fn is_dirty (& self , bit : u8) -> bool { (self . dirty_mask & (1u64 << bit)) != 0 } } # [wasm_bindgen] impl Counter { pub fn update (& mut self) { if self . dirty_mask == 0 { return ; } if self . is_dirty (0u8) { log (& format ! ("Updating slot {} with value: {:?}" , 0u32 , "self.count")) ; } self . clear_dirty () ; } pub fn render (& self) { log (& format ! ("Rendering {}" , stringify ! (Counter))) ; } }